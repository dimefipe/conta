:root{
  --bg:#f5f6f8;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#6b7280;

  --topbar-h:56px;
  --sidebar-w:280px;

  --border:#e5e7eb;
  --shadow:0 14px 40px rgba(15,23,42,.08);

  --radius:16px;
  --radius-sm:12px;

  --black:#0b0b0b;
  --danger:#e11d48;

  --active-bg:#e9eefc;
  --active-border:#c7d2fe;

  /* Tooltip card */
  --tip-bg:#ffffff;
  --tip-border: var(--border);
  --tip-shadow: 0 18px 45px rgba(15,23,42,.14);
  --tip-accent: rgba(99,102,241,.14);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* ===== Public layout ===== */
.public-wrap{ padding: 16px; }
.public-center{ max-width:560px; margin: 28px auto; }
.public-center .card{ margin-bottom: 0; }

/* ===== Topbar ===== */
.topbar{
  position:fixed;
  top:0; left:0; right:0;
  height:var(--topbar-h);
  background: linear-gradient(180deg, #0b0b0b, #111);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 0 14px;
  z-index:1200;
}

.topbar-left{
  display:flex;
  align-items:center;
  gap:12px;
  min-width: 200px;
}
.brand-title{ font-weight:800; letter-spacing: .2px; }
.brand-sub{
  font-size:12px;
  color:rgba(255,255,255,.75);
  margin-top:2px;
  max-width: 240px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.topbar-right{ display:flex; align-items:center; gap:10px; }
.topbar-desktop{ display:flex; }

.company-switch select{
  height:38px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.06);
  color:#fff;
  padding: 0 12px;
  outline:none;
}
.company-switch option{ color:#111; }

.userbox{ display:flex; align-items:center; gap:10px; }

/* chip (base) */
.chip{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  height:38px;
  padding:0 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.06);
  color:#fff;
  text-decoration:none;
  font-size:13px;
  white-space:nowrap;
}
.chip.grow{ width:100%; justify-content:flex-start; }

/* ===== Hamburger ===== */
.menu-toggle{
  width:40px;
  height:40px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.06);
  color:#fff;
  cursor:pointer;
  font-size:18px;
  display:none;
}

/* ===== Sidebar (desktop) ===== */
.sidebar{
  position:fixed;
  top:var(--topbar-h);
  left:0;
  bottom:0;
  width:var(--sidebar-w);
  background:#fff;
  border-right:1px solid var(--border);
  padding:14px;
  z-index:1100;

  /* layout */
  display:flex;
  flex-direction:column;
  gap:12px;
  overflow:hidden; /* NO scroll aquí */
}

.sidebar-head{
  padding-bottom: 10px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 12px;
}

.sidebar-title{
  font-weight:800;
  margin: 2px 0 10px;
}

.sidebar-account{
  display:none; /* solo mobile */
  gap:10px;
}
.sidebar-account .field label{ margin-bottom: 6px; }

.sidebar-userrow{
  display:flex;
  gap:10px;
  align-items:center;
}

/* ✅ FIX: chip dentro del SIDEBAR debe ser oscuro (si no, “desaparece”) */
.sidebar .chip{
  color: var(--text);
  background:#fff;
  border:1px solid var(--border);
}

/* ===== Nav (SCROLL SOLO AQUÍ) ===== */
.nav{
  display:flex;
  flex-direction:column;
  gap:12px;

  flex:1 1 auto;
  min-height:0;

  overflow-y:auto;
  -webkit-overflow-scrolling: touch;

  padding-right: 6px;
}

.nav::-webkit-scrollbar{ width: 8px; }
.nav::-webkit-scrollbar-thumb{ background: #e5e7eb; border-radius: 10px; }
.nav::-webkit-scrollbar-track{ background: transparent; }

/* ===== Nav groups (padre + flecha) ===== */
.nav-group{
  border:1px solid var(--border);
  border-radius: 18px;
  background:#fff;

  /* ✅ FIX: evitar que iOS “corte” el contenido del submenu */
  overflow: visible;
}

.nav-group-row{
  display:flex;
  align-items:stretch;
  border-radius:18px;
  overflow:hidden; /* solo en la fila, para mantener redondeo */
  border:1px solid transparent; /* mantiene layout */
}

.nav-group.open .nav-group-row{
  border-bottom: 1px solid var(--border);
  border-radius:18px 18px 0 0;
}

.nav-group-link{
  flex:1;
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px 12px!important;
  text-decoration:none;
  color:var(--text);
  background:#fff;
}

.nav-group-link:hover{ background:#f8fafc; }

.nav-group-link.active{
  background: var(--active-bg);
  border-color: var(--active-border);
  font-weight:800;
}

.nav-group-left{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
}

.nav-ico{
  width:28px;
  height:28px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:12px;
  background:#fff;
  border:1px solid var(--border);
}

.nav-group-title{
  font-weight:800;
  font-size:14px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* botón flecha */
.nav-group-toggle{
  width:54px;
  border:0;
  border-left:1px solid var(--border);
  background:#fff;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

.nav-group.open .nav-group-toggle{
  background:#f8fafc;
}

.nav-caret{
  opacity:.7;
  transition: transform .15s ease;
}
.nav-group.open .nav-caret{ transform: rotate(180deg); }

/* ===== Submenu (colapsable) ===== */
.nav-sub{
  display:grid;
  gap:8px;

  max-height:0;
  opacity:0;
  overflow:hidden;

  padding:0 12px;
  border-radius:0 0 18px 18px;

  transition: max-height .22s ease, opacity .15s ease, padding .2s ease;
  pointer-events:none;
}

/* ✅ FIX: max-height grande + padding para que NUNCA se “corte” */
.nav-group.open .nav-sub{
  max-height: 2000px;
  opacity:1;
  padding: 10px 12px 12px 12px;
  pointer-events:auto;
}

/* ===== Sub items ===== */
.nav-item{
  display:block;
  text-decoration:none;
  color:var(--text);
  background:#fff;
  border:1px solid var(--border);
  padding: 10px 12px;
  border-radius: 14px;
  transition: background .12s ease, border-color .12s ease;
  font-size:14px;
}
.nav-item:hover{ background:#f8fafc; }

.nav-item.active{
  background: var(--active-bg);
  border-color: var(--active-border);
  font-weight:800;
}

.nav-item.disabled{
  opacity:.55;
  cursor:not-allowed;
}

.nav-item.nav-external{
  margin-top: 2px;
  background:#fff;
}

.nav-hint{
  margin-left:8px;
  font-size:12px;
  opacity:.65;
}

/* ===== Main ===== */
.main{
  margin-left:var(--sidebar-w);
  padding: calc(var(--topbar-h) + 18px) 18px 18px;
  min-height:100vh;
}

/* ===== Overlay ===== */
.overlay{
  display:none;
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.45);
  z-index:1150;
}

/* ===== Cards / forms ===== */
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:16px;
  box-shadow: var(--shadow);
  margin-bottom:14px;
}

.row{ display:flex; gap:12px; flex-wrap:wrap; }

.field label{
  display:block;
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}

input, select, textarea{
  width:100%;
  height:42px;
  border:1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 0 12px;
  background:#fff;
  outline:none;
}
textarea{ height:auto; padding: 10px 12px; }
.small{ font-size:12px; color:var(--muted); }

/* input con botón (toggle pass) */
.input-wrap{ position:relative; }
.pw-toggle{
  position:absolute;
  top:50%;
  right:10px;
  transform: translateY(-50%);
  width:38px;
  height:38px;
  border-radius: 12px;
  border:1px solid var(--border);
  background:#fff;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.pw-toggle svg{ width:20px; height:20px; opacity:.75; }

/* ===== Buttons ===== */
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  height:42px;
  padding: 0 14px;
  border-radius: 14px;
  border:1px solid transparent;
  cursor:pointer;
  text-decoration:none;
  background:#111;
  color:#fff;
  font-weight:700;
}
.btn.secondary{
  background:#fff;
  color:#111;
  border-color: var(--border);
}
.btn.danger{ background: var(--danger); color:#fff; }
.smallbtn{
  height:38px;
  padding: 0 12px;
  border-radius: 14px;
  font-size:13px;
}

/* ===== Alerts ===== */
.alert{
  border-radius: 14px;
  padding:12px 14px;
  border:1px solid var(--border);
  background:#fff;
  margin-bottom:12px;
}
.alert.ok{ border-color:#bbf7d0; background:#ecfdf5; }
.alert.err, .alert.danger{ border-color:#fecaca; background:#fff1f2; }

/* ===== Tables ===== */
.table-wrap{ width:100%; overflow:auto; border-radius: 14px; }
.table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border:1px solid var(--border);
  border-radius:14px;
  overflow:hidden;
  min-width: 720px;
}
.table th, .table td{
  padding:12px;
  border-bottom:1px solid var(--border);
  text-align:left;
  font-size:14px;
  vertical-align:middle;
}
.table th{
  background:#f8fafc;
  font-size:12px;
  letter-spacing:.02em;
  text-transform:uppercase;
  color:#374151;
}
.table tr:last-child td{ border-bottom:none; }

/* =========================================================
   TOOLTIP “CARD” (más visual)
   Compatible con:
     - data-tooltip="..."
     - data-tip="..."
   ========================================================= */

[data-tooltip],
[data-tip]{
  position: relative;
}

/* caja tooltip (card) */
[data-tooltip]::after,
[data-tip]::after{
  content: attr(data-tooltip);
  position: absolute;
  left: calc(100% + 14px);
  top: 50%;
  transform: translateY(-50%) translateX(-6px);

  min-width: 220px;
  max-width: 280px;

  background: linear-gradient(180deg, var(--tip-accent), var(--tip-bg) 44px);
  color: var(--text);
  border: 1px solid var(--tip-border);
  border-radius: 14px;
  box-shadow: var(--tip-shadow);
  padding: 12px 12px 12px 12px;

  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: opacity .12s ease, transform .12s ease, visibility .12s ease;
  z-index: 9999;

  font-size: 13px;
  line-height: 1.35;
  white-space: normal;
}

/* si usas data-tip, el contenido correcto */
[data-tip]::after{
  content: attr(data-tip);
}

/* flecha */
[data-tooltip]::before,
[data-tip]::before{
  content: "";
  position: absolute;
  left: calc(100% + 14px);
  top: 50%;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-top: 9px solid transparent;
  border-bottom: 9px solid transparent;
  border-right: 9px solid var(--tip-bg);
  filter: drop-shadow(-1px 0 0 var(--tip-border));

  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: opacity .12s ease, visibility .12s ease;
  z-index: 10000;
}

/* hover/focus: mostrar */
[data-tooltip]:hover::after,
[data-tooltip]:focus-visible::after,
[data-tip]:hover::after,
[data-tip]:focus-visible::after{
  opacity: 1;
  visibility: visible;
  transform: translateY(-50%) translateX(0);
}

[data-tooltip]:hover::before,
[data-tooltip]:focus-visible::before,
[data-tip]:hover::before,
[data-tip]:focus-visible::before{
  opacity: 1;
  visibility: visible;
}

/* ===== Responsive ===== */
@media (max-width: 1023px){
  .menu-toggle{ display:inline-flex; }
  .topbar-desktop{ display:none; }

  .sidebar{
    top:0;
    height:100dvh; /* ✅ clave */
    transform: translateX(-105%);
    transition: transform .18s ease;
    box-shadow: var(--shadow);
    z-index:1201;
    width: min(92vw, var(--sidebar-w));
    padding-bottom: calc(14px + env(safe-area-inset-bottom));
  }

  body.menu-open .sidebar{ transform: translateX(0); }
  body.menu-open .overlay{ display:block; }

  .sidebar-account{ display:flex; flex-direction:column; }

  /* ✅ en mobile: el NAV ocupa el alto restante y scrollea */
  .sidebar .nav{
    flex:1 1 auto;
    min-height:0;
    overflow-y:auto;
  }

  .main{
    margin-left:0;
    padding: calc(var(--topbar-h) + 14px) 14px 14px;
  }
}

/* En mobile no mostramos tooltip hover */
@media (max-width: 900px){
  [data-tooltip]::after,
  [data-tooltip]::before,
  [data-tip]::after,
  [data-tip]::before{
    display:none !important;
  }
}
